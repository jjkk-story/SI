
<html>
<head>
    <title>서울연구데이터</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Do+Hyeon|Noto+Sans+KR&display=swap" rel="stylesheet">
    <link href="https://data.si.re.kr/R/css/sichart.css" rel="stylesheet">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script>
        window.onresize = function() {
            drawVisualization();
        };
        window.onload = function(){
            if(window.innerHeight < window.innerWidth){
            	$("#chart0_div").height(window.innerHeight - 70);
            	$("#chart1_div").height(window.innerHeight - 180);
            }else{
                $("#chart0_div").height(window.innerHeight - 110);
                $("#chart1_div").height(window.innerHeight - 260);
            }
        }
        function copy_to_clipboard() {
            var copyText = document.getElementById("sicode");
            copyText.select();
            document.execCommand("Copy");
        }

    </script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <!--<div class="header">
            <div class="hc01">
                <img src="https://data.si.re.kr/R/images/si-logo-white.png" height="30px">
            </div>
            <div id="title" class="hc02"></div>
        </div>-->
 
        <!-- Content -->
        <div id="main-content" class="content">

            <div id="dashboard0_div">
                <div id="filter0_div" class="filter_div" style="display: none;"></div>
                <div id="chart0_div" style="width: 100%; height: 80vh; float: left;"></div>
            </div>
            <div id="dashboard1_div">
                <div id="filter1_div" class="filter_div"></div>
                <div id="chart1_div" style="width: 100%; height: 80vh; float: left;"></div>
            </div>
            <div class="custom-legend" style="width: auto; text-align: right; float: right; margin-right: 40px;">
                <div id="legends"></div>
                <div style="clear: both;"></div>
            </div>
        </div> 
  <!-- Footer -->
        <div class="footer">
            <div class="control">
                <div class="fc01">
                	<div class="play-buttons">
	                    <button id="btn-play" class="btn01" value="play" style="width: 60px;margin-right: 5px;">PLAY</button>
	                </div>
                    <div id="progressbar">
                        <div id="year-range">
                            <div id="year-text">
                                <div id="year-start" style="float: left;"></div>
                                <div id="year-end" style="float: right;"></div>
                            </div>
                        </div>
                        <div id="index">
                            <div id="ruler"></div>
                        </div>
                        <div class="slidecontainer">
                            <input type="range" min="1" max="10" value="1" class="slider" id="bar-range">
                        </div>
                    </div>
                    <div id="label_div"></div>
                </div>
                <!--<div class="fc02">

                    <button id="btn-full" class="btn02">
                        <svg width="10px" height="10px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <g id="Desktop-HD" transform="translate(-734.000000, -568.000000)" fill="#2E3A59">
                                    <path d="M734,578.5 C734,579.32875 734.480839,580 735.339202,580 L739.2232,580 C739.651994,580 740,579.664 740,579.25 C740,578.836 739.651994,578.5 739.2232,578.5 L737.375194,578.5 C737.029518,578.5 736.856292,578.09575 737.100984,577.8595 L739.450803,575.59075 C739.753755,575.29825 739.753755,574.8235 739.450803,574.53025 C739.147074,574.23775 738.65536,574.23775 738.352408,574.53025 L736.109788,576.799 C735.865096,577.03525 735.553599,576.868 735.553599,576.53425 L735.553599,574.75 C735.553599,574.336 735.098395,574 734.669601,574 L734.7232,574 C734.294407,574 734,574.336 734,574.75 L734,578.5 Z M740.724988,568 C740.324795,568 740,568.336 740,568.75 C740,569.164 740.324795,569.5 740.724988,569.5 L742.449734,569.5 C742.772354,569.5 742.934026,569.90425 742.705655,570.1405 L740.512566,572.40925 C740.229821,572.70175 740.229821,573.1765 740.512566,573.46975 C740.796037,573.76225 741.254954,573.76225 741.537699,573.46975 L743.830836,571.201 C744.059207,570.96475 744.550024,571.132 744.550024,571.46575 L744.550024,573.25 C744.550024,573.664 744.77477,574 745.174964,574 L745.224988,574 C745.625181,574 746,573.664 746,573.25 L746,569.5 C746,568.67125 745.151039,568 744.349928,568 L740.724988,568 Z" id="arrow_left_down_right_up-[#380]"></path>
                                </g>
                            </g>
                        </svg>
                    </button>
                    <button id="btn-menu" class="btn02">
                        <svg width="10px" height="10px" viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <g id="Desktop-HD" transform="translate(-768.000000, -569.000000)" fill="#2E3A59">
                                    <path d="M768,579 L778,579 L778,577 L768,577 L768,579 Z M768,571 L778,571 L778,569 L768,569 L768,571 Z M768,575 L778,575 L778,573 L768,573 L768,575 Z" id="align_text_distribute-[#914]"></path>
                                </g>
                            </g>
                        </svg>
                    </button>
                </div>-->
            </div>
        </div>
        <div class="screen" style="display: none;">
        </div>

        <div id="popup-menu" class="popup" style="display: none;">
            <div class="top">
                <a onclick="closePopup();" class="close-popup">
                    <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Desktop-HD" transform="translate(-556.000000, -84.000000)" fill="#000000">
                                <g id="Popup">
                                    <polygon id="close-[#1511]" points="567.446 94 576 102.554 574.553 104 566 95.446 557.446 104 556 102.554 564.553 94 556 85.446 557.446 84 566 92.554 574.553 84 576 85.446"></polygon>
                                </g>
                            </g>
                        </g>
                    </svg>
                </a>
            </div>
            <div class="message">
                <br>
                <h4 id="title-data">Share</h4>
                <div class="note">Please click share button.</div>
                <br>
                <button id="btn-facebook" class="btn03" onclick="snsShare(1)">Facebook</button>

                <br>
                <button id="btn-twitter" class="btn03" onclick="snsShare(2)">Twitter</button>
                <textarea id="sicode"><iframe src=https://data.si.re.kr/R/sic-line.html width=800 height=600 ></iframe></textarea>
                <button class="btn03" onclick="copy_to_clipboard()">Copy</button>
            </div>
        </div>
    </div> 
<script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart", "controls", "table"]});
        google.setOnLoadCallback(drawVisualization);

        //////////////////// data ///////////////////////////////////////////

 
var colName0 =  ["year","1.서울-서울","2.서울-비서울","3.비서울-서울"] 
var dataRaw0 =  [["2016",26106.062,4221.409,4184.075],["2017",25858.896,4184.985,4150.482],["2018",25561.68,4217.77,4177.282],["2019",25343.656,4302.58,4198.278],["2020",22183.364,3640.887,3585.141]] 
var colNameGu0 =  ["year","1.서울-서울","2.서울-비서울","3.비서울-서울"] 
var dataGu0 =  [["2016","1.승용차",4300.673,1792.146,1764.961],["2016","2.버스",6625.783,915.159,888.782],["2016","3.지하철·철도(환승 미포함)",5300.594,1060.646,1112.512],["2016","4.택시",1909.187,113.242,99.238],["2016","5.도보",6860.491,11.455,11.321],["2016","6.오토바이/기타",1109.334,328.761,307.261],["2017","1.승용차",4288.308,1801.065,1775.975],["2017","2.버스",6402.065,856.14,842.398],["2017","3.지하철·철도(환승 미포함)",5347.145,1070.895,1119.677],["2017","4.택시",1899.072,114.442,93.604],["2017","5.도보",6803.081,12.625,11.318],["2017","6.오토바이/기타",1119.225,329.818,307.51],["2018","1.승용차",4236.892,1831.027,1813.037],["2018","2.버스",6248.767,818.377,804.514],["2018","3.지하철·철도(환승 미포함)",5457.357,1103.283,1140.55],["2018","4.택시",1822.793,114.988,95.025],["2018","5.도보",6664.385,15.039,13.298],["2018","6.오토바이/기타",1131.486,335.056,310.858],["2019","1.승용차",4199.929,1856.915,1823.022],["2019","2.버스",6134.579,791.761,793.293],["2019","3.지하철·철도(환승 미포함)",5524.986,1185.569,1143.665],["2019","4.택시",1624.667,101.057,100.429],["2019","5.도보",6675.298,18.104,16.799],["2019","6.오토바이/기타",1184.197,349.174,321.07],["2020","1.승용차",3995.032,1795.904,1767.704],["2020","2.버스",4688.028,539.181,519.295],["2020","3.지하철·철도(환승 미포함)",4310.091,913.577,942.143],["2020","4.택시",1261.818,75.304,74.424],["2020","5.도보",6745.017,16.682,14.841],["2020","6.오토바이/기타",1183.378,300.239,266.734]] 
var filterLabel = "year";
var webFolder = "trfc_md_vlm_time_bar";
var chartTitle = "수도권 수단통행량";
var colorSet = ["BFC882","F0EAD2","b08968"];
var yearRange = [2016,2020];
var fontSize0 = 10;
var fontColor0 = "#999999";
var bStacked = true;
var barWidth = "90%";
var aniChartType = "v";
var axTitle = "(천 통행/일)";
var isTotal = "F";
var max0 = 38000;
var min0 = 0;
var max1 = 10000; 

        //////////////////// chart //////////////////////////////////////////



        var fontName0 = "Noto Sans KR";
        var textStyle0 = {
            fontName: fontName0,
            fontSize: fontSize0,
            color: fontColor0
        };
        var textStyleLegend = {
            fontName: fontName0,
            fontSize: 12,
            color: "#404c6a"
        };


        var slider = document.getElementById("bar-range");



        document.getElementById("year-start").innerHTML = yearRange[0];
        document.getElementById("year-end").innerHTML = yearRange[1];

        document.getElementById("sicode").innerHTML = "<iframe src=http://data.si.re.kr/"+webFolder+" width=800 height=600 ></iframe>";

        function snsShare(sns){
            if(sns == 1){
                window.open("https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fdata.si.re.kr%2F"+webFolder+"&amp;src=sdkpreparse", "_blank");
            }else{
                window.open("https://twitter.com/intent/tweet?text="+chartTitle+"&url=http%3A%2F%2Fdata.si.re.kr%2F"+webFolder, "_blank");
            }
        }

        function fileDown(){
            window.open(dataFile01, "_blank");
        }

        var dataArr0 = [];
        dataArr0.push(colName0);
        for (var i in dataRaw0) {
            dataArr0.push(dataRaw0[i]);
        }


        if (isTotal == "T"){
            var dataArr1a = [];
            dataArr1a.push(colName1a);
            for (var i in dataRaw1a) {
                dataArr1a.push(dataRaw1a[i]);
            }
            var dataArr2a = [];
            dataArr2a.push(colName2a);
            for (var i in dataRaw2a) {
                dataArr2a.push(dataRaw2a[i]);
            }
        }



        function drawVisualization() {
            drawChartRegion(dataArr0, dataRaw0, dataGu0, min0, max0, max1);

        }

        function drawChartRegion(regionData, dataRaw, dataGu, amin, amax, amax1) {
            var yearPattern = "####";
            var formatNumber = new google.visualization.NumberFormat({
                pattern: yearPattern
            });



            var data = google.visualization.arrayToDataTable(regionData);


            formatNumber.format(data, 0);

            var dashboard0 = new google.visualization.Dashboard(document.getElementById("dashboard0_div"));   

            var options0 = {};
            var mChartType = "";
            if (aniChartType == "v"){
                options0 = {
                    chartArea: {
                        width: "85%",
                        height: "90%"
                    },
                    colors: colorSet,
                    focusTarget : "category",
                    bar: {
                            groupWidth: barWidth,
                        },
                    hAxis: {
                        textStyle: textStyle0,
                        format: "####",
                    },
                    vAxis: {
                        viewWindow: {
                            max: max0,
                            min: min0
                        },
                        textStyle: textStyle0,
                        title: axTitle,
                        titleTextStyle: textStyleLegend,
                        format: "####.##",
                    },
                    legend: {
                        textStyle: textStyleLegend,
                        position: "top"
                    },
                    tooltip: {
                        textStyle: textStyleLegend
                    },

                    animation: {
                        duration: 500,
                        easing: "out"
                    },
                    isStacked: bStacked,

                };
                mChartType = "ColumnChart";

            }else{

                options0 = {
                    chartArea: {
                        width: "85%",
                        height: "90%"
                    },
                    colors: colorSet,
                    focusTarget : "category",
                    bar: {
                            groupWidth: barWidth,
                        },
                    hAxis: {
                        viewWindow: {
                            max: max0,
                            min: min0
                        },
                        textStyle: textStyle0,
                        title: axTitle,
                        titleTextStyle: textStyleLegend,
                        format: "####.##",
                    },
                    vAxis: {
                        textStyle: textStyle0,
                        format: "####",
                    },
                    legend: {
                        textStyle: textStyleLegend,
                        position: "top"
                    },
                    tooltip: {
                        textStyle: textStyleLegend
                    },

                    animation: {
                        duration: 500,
                        easing: "out"
                    },
                    isStacked: bStacked,

                };
                mChartType = "BarChart";

            }

            var chart0 = new google.visualization.ChartWrapper({
                "chartType": mChartType,
                "containerId": "chart0_div",
                "options": options0
            });
            var table0 = new google.visualization.ChartWrapper({
                "chartType": "Table",
                "containerId": "table0_div",
            });

            var filter0 = new google.visualization.ControlWrapper({
                "controlType": "CategoryFilter",
                "containerId": "filter0_div",
                "options": {
                    "filterColumnLabel": filterLabel
                }
            })

 

            //////////////////////////////////////////////////
            //////////////////// series //////////////////////
            //////////////////////////////////////////////////
            var view = new google.visualization.DataView(data);
            //legend click
            var colu = [];
            var series = {};
            for (var i = 0; i < data.getNumberOfColumns(); i++) {
                colu.push(i);
                if (i > 0) {
                    series[i - 1] = {};
                }
            }

            //////////////////////////////////////////////////
            //////////////////////////////////////////////////
            //////////////////////////////////////////////////
            dashboard0.bind(filter0, [chart0]);
            dashboard0.draw(view);

            // 비활성화된 column의 라벨 색상을 바꾸기 위한 array
            var deactivated_columns = [];

            //legend click
            var columns = [];
            var series = {};
            for (var i = 0; i < data.getNumberOfColumns(); i++) {
                columns.push(i);
                if (i > 0) {
                    series[i - 1] = {};
                }
            }
            google.visualization.events.addListener(chart0, "select", function() {
                var sel = chart0.getChart().getSelection();
                if (sel.length > 0) {
                    if (sel[0].row === null) {
                        var col = sel[0].column;
                        //console.log(col);
                        if (columns[col] == col) {
                            // hide the data series
                            columns[col] = {
                                label: data.getColumnLabel(col),
                                type: data.getColumnType(col),
                                calc: function() {
                                    return null;
                                }
                            };

                            // grey out the legend entry
                            series[col - 1].color = "#CCCCCC";
                        } else {
                            // show the data series
                            columns[col] = col;
                            series[col - 1].color = null;
                        }
                        //var view = new google.visualization.DataView(data);
                        view.setColumns(columns);
                        dashboard0.draw(view);

                        setTimeout(function() {
                          var chartContainer = document.getElementById("chart0_div");
                          var labels = chartContainer.getElementsByTagName("text");
                          for (var i = 0; i < labels.length; i++) {
                            // determine if label should be bold
                            if (i == (col-1)) {
                              if ($.inArray((col-1), deactivated_columns) == "-1") {
                                labels[i].setAttribute("style", "fill:#bbb;");
                                deactivated_columns.push(col-1);
                              } else {
                                deactivated_columns.splice($.inArray((col-1), deactivated_columns), 1);
                              }
                            } else {
                              if ($.inArray(i, deactivated_columns) != "-1") {
                                labels[i].setAttribute("style", "fill:#bbb;");
                              }
                            }
                          }
                        }, 1000);

                    }
                }
            });

            ///////////////////////
            //// Series Charts ////
            ///////////////////////

            var dataS = [];
            var dashboard1 = new google.visualization.Dashboard(document.getElementById("dashboard1_div"));
            var options1 = {};
            var aChartType = "";
            if (aniChartType == "v"){
                options1 = {
                    chartArea: {
                        width: "90%",
                        height: "85%"
                    },
                    colors: colorSet,
                    focusTarget : "category",
                    bar: {
                        groupWidth: barWidth,
                    },
                    hAxis: {
                        textStyle: textStyle0,
                        slantedText:true,
                        slantedTextAngle:45
                    },
                    vAxes: {
                        0:{
                            viewWindow: {
                                max: amax1,
                                min: amin
                            },
                            textStyle: textStyle0,
                            title: axTitle,
                            titleTextStyle: textStyleLegend,

                        }
                    },
                    legend: {
                        position: "none"
                    },
                    tooltip: {
                        textStyle: textStyleLegend
                    },
                    animation: {
                        duration: 500,
                        easing: "out"
                    },
                    isStacked: bStacked,

                };
                aChartType = "ColumnChart";

            }else{
                options1 = {
                    chartArea: {
                        width: "90%",
                        height: "85%"
                    },
                    colors: colorSet,
                    focusTarget : "category",
                    bar: {
                        groupWidth: barWidth,
                    },
                    hAxes: {
                        0:{
                            viewWindow: {
                                max: amax1,
                                min: amin
                            },textStyle: textStyle0,
                            title: axTitle,
                            titleTextStyle: textStyleLegend,
                        }
                    },
                    vAxis: {
                        textStyle: textStyle0
                    },
                    legend: {
                        position: "none"
                    },
                    tooltip: {
                        textStyle: textStyleLegend
                    },
                    animation: {
                        duration: 500,
                        easing: "out"
                    },
                    isStacked: bStacked,

                };
                aChartType = "BarChart";

            }
            //console.log(Object.values(options1));

            var chart1 = new google.visualization.ChartWrapper({
                "chartType": aChartType,
                "containerId": "chart1_div",
                "options": options1
            });

            var filter1 = new google.visualization.ControlWrapper({
                "controlType": "CategoryFilter",
                "containerId": "filter1_div",
                "options": {
                    "filterColumnLabel": colName0[0],
                    ui: {

                        label: "지역선택",
                        allowTyping: true,
                        allowMultiple: true,
                        caption : "지역선택",
                        allowNone: true,
                        selectedValuesLayout: "aside"
                    }
                }
            });

            dashboard1.bind(filter1, [chart1]);

            var current = 1;
            var limit = dataRaw.length;
            barlimit = dataRaw.length;
            var rulerSize = 400 / (limit-1);
            //console.log(dataRaw.length);

            for (var i in dataRaw) {

                if (i < dataRaw.length) {
                    //console.log("dataRaw For");


                    var filtered_arr = [];
                    filtered_arr.push(dataGu.filter(function(element) {
                        return element[0] == dataRaw[i][0];
                    }));
                    //console.log(Object.values(dataGu));
                    //console.log(Object.values(colNameGu0));

                    var divArr = new Array();
                    divArr.push(colNameGu0);

                    filtered_arr = filtered_arr[0]; //remove wrapper
                    for (var n in filtered_arr) {
                        divArr.push(filtered_arr[n].slice(1));
                        //console.log("dataRaw ForFor");
                    }
                    //console.log(Object.values(divArr));
                    //console.log(i + "- " + popage_arr);
                    dataS[i] = google.visualization.arrayToDataTable(divArr);
                    i++; /// 중요

                }
            }
            document.getElementById("ruler").innerHTML = makeRuler(limit, rulerSize);

            //console.log(Object.values(dataS));

            function drawChart() {
                console.log(current + "/" + limit);
                //console.log(dataS[1]);
                dashboard1.draw(dataS[current-1]);
                document.getElementById("label_div").innerHTML = regionData[current][0];
                document.getElementById("bar-range").value = current;
                //console.log(current + "/" + limit);
            }
            //drawChart();



            //// Buttons ////
            var btnPlay = document.getElementById("btn-play");
            var button2 = document.getElementById("btn2");
            var button3 = document.getElementById("btn3");
            var btnRefresh = document.getElementById("btn-refresh");
            var btnData = document.getElementById("btn-data");
            var btnRes = document.getElementById("btn-res");
            var btnFull = document.getElementById("btn-full");
            var btnMenu = document.getElementById("btn-menu");
            var btnPrev = document.getElementById("btn-preview");

            btnPlay.onclick = function() {
                //console.log(btnPlay.value);

                $("#dashboard1_div").show();
                $("#dashboard0_div").hide();
                $(".custom-legend").show();

                //current = 1;
                if (btnPlay.value == "play") {

                    playChart = setInterval(function() {
                        drawChart();
                        if (current >= limit) {
                            current = 1;
                            clearInterval(playChart);
                            btnPlay.value = "play";
                            btnPlay.innerHTML = "PLAY";
                        }
                        //console.log(current + "/" + limit);
                        // current 가 string으로 인식돼서, combine 되는 문제. *1 해서 정수화하면 해결.
                        current = current*1 + 1;
                    }, 1000);
                    btnPlay.value = "stop";
                    btnPlay.innerHTML = "STOP";
                } else {
                    clearInterval(playChart);
                    btnPlay.value = "play";
                    btnPlay.innerHTML = "PLAY";
                }

            }

            btnMenu.onclick = function() {
                $(".screen").show();
                $("#popup-menu").show();
            }
            btnFull.onclick = function() {
                window.open("https://data.si.re.kr/" + webFolder, "_blank");
            }


            //slider = document.getElementById("bar-range");
            slider.max = limit;

            slider.oninput = function() {
                current = this.value;
                //console.log(this.value);
                drawChart();

            }

            //document.getElementById("title").innerHTML = chartTitle;

        }

        function makeRuler(iNum, rSize){
        	var sRuler = "";
        	var i = 1;
        	while(i < iNum){
        		sRuler = sRuler + "<div style=width:" + rSize + "px></div>";
        		i++;
        		//console.log(i);
        	}
        	return sRuler;
        }
        $("#dashboard1_div").hide();

        function closePopup() {
            $(".screen").hide();
            $("#popup-data").hide();
            $("#popup-res").hide();
            $("#popup-menu").hide();
            $("#popup-prev").hide();
        }
        function closePopupPrev() {
            $("#popup-res").hide();
            $("#popup-menu").hide();
            $("#popup-prev").hide();
        }
        function generateLegnend(colors, items) {
            var html = "";
            var n = 0;
            for (var i in items) {
                if(i > 0){ //총계 삭제
                    if(n >= colors.length){
                        n = 0;
                    }
                    html = html + "<div class=\"legend-item\"><div class=\"color-box\" style=\"background-color: "+colors[n]+";\"></div>"+items[i]+"</div>";
                    n++;
                }
            }
            return html;
        }

        document.getElementById("legends").innerHTML = generateLegnend(colorSet, colName0);


    </script>
 
</body>
</html>


